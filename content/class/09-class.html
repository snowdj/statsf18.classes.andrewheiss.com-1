---
title: "Sampling"
date: "2018-11-01"
citeproc: false
bibliography: ../../static/bib/references.bib
csl: ../../static/bib/chicago-syllabus-no-bib.csl
output:
  blogdown::html_page:
    template: ../../pandoc/toc-title_html.template
    toc: true
editor_options: 
  chunk_output_type: console
stuff-to-add: >-
  https://www.nytimes.com/2013/09/24/science/as-normal-as-rabbits-weights-and-dragons-wings.html?_r=0
  Random coin toss vs. made up random coins
---

<!-- BLOGDOWN-HEAD -->
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>
<!-- /BLOGDOWN-HEAD -->

<h2>Contents</h2>
<div id="TOC">
<ul>
<li><a href="#slides">Slides</a></li>
<li><a href="#mms">M&amp;Ms</a><ul>
<li><a href="#mm-reporting-form">M&amp;M reporting form</a></li>
<li><a href="#the-true-population-parameters-of-mm-colors">The true population parameters of M&amp;M colors</a></li>
<li><a href="#mms-in-real-life">M&amp;Ms in real life</a></li>
<li><a href="#simulated-mms">Simulated M&amp;Ms</a></li>
<li><a href="#the-importance-of-sample-size">The importance of sample size</a></li>
</ul></li>
<li><a href="#clearest-and-muddiest-things">Clearest and muddiest things</a></li>
</ul>
</div>

<h2 id="slides">Slides</h2>
<p>Download the slides from today’s lecture:</p>
<ul>
<li><a href="/slides/MPA-630_2018-11-01.pdf"><i class="fas fa-file-pdf"></i> PDF (best option)</a></li>
<li><a href="/slides/MPA-630_2018-11-01.pptx"><i class="fas fa-file-powerpoint"></i> PowerPoint</a></li>
</ul>
<figure>
<a href="/slides/MPA-630_2018-11-01.pdf"><img src="/images/slides/slides_2018-11-01.png" alt="First slide" /></a>
</figure>
<h2 id="mms">M&amp;Ms</h2>
<p>In class we used M&amp;Ms to explore how sampling works. Here’s an analysis of this exploration in R. Load these packages to get started, and download these two datasets (and put them in a folder named “data”):</p>
<ul>
<li><a href="/data/tons_of_mms.csv"><i class="fas fa-table"></i> <code>tons_of_mms.csv</code></a></li>
<li><a href="/data/class_mms.csv"><i class="fas fa-table"></i> <code>class_mms.csv</code></a></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(moderndive)
<span class="kw">library</span>(pander)
<span class="kw">library</span>(scales)

<span class="co"># Setting a random seed ensures that every random draw will be the same each</span>
<span class="co"># time you run this (and regardless of what computer you run this on)</span>
<span class="kw">set.seed</span>(<span class="dv">1234</span>)

<span class="co"># Official M&amp;M colors via</span>
<span class="co"># - Wikipedia: https://en.wikipedia.org/wiki/M%26M%27s</span>
<span class="co"># - This palette: https://colorswall.com/palette/172/</span>
mm_red &lt;-<span class="st"> &quot;#b11224&quot;</span>
mm_orange &lt;-<span class="st"> &quot;#f26f22&quot;</span>
mm_yellow &lt;-<span class="st"> &quot;#fff200&quot;</span>
mm_green &lt;-<span class="st"> &quot;#31ac55&quot;</span>
mm_blue &lt;-<span class="st"> &quot;#2f9fd7&quot;</span>
mm_brown &lt;-<span class="st"> &quot;#603a34&quot;</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tons_of_mms &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/tons_of_mms.csv&quot;</span>)
class_results &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/class_mms.csv&quot;</span>)</code></pre>
<h3 id="mm-reporting-form">M&amp;M reporting form</h3>
<p>Go here to report the count of M&amp;Ms in your bag:</p>
<ul>
<li><i class="fas fa-question-circle"></i> <a href="https://goo.gl/forms/o0MW5ERwh67Iake03">Reporting form</a></li>
</ul>
<h3 id="the-true-population-parameters-of-mm-colors">The true population parameters of M&amp;M colors</h3>
<p>Because of <a href="https://blogs.sas.com/content/iml/2017/02/20/proportion-of-colors-mandms.html">the work of smart/bored statisticians</a> (and from the Mars company itself), we actually know the true population-level parameters for the proportion of colors. For whatever reason, M&amp;Ms’s two US factories produce a different mix of colors (perhaps the East Coast likes blue M&amp;Ms more?). Here are the true population parameters:</p>
<pre class="sourceCode r"><code class="sourceCode r">mms_population &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>color,   <span class="op">~</span>prop_clv, <span class="op">~</span>prop_hkp,
  <span class="st">&quot;Red&quot;</span>,    <span class="fl">0.131</span>,     <span class="fl">0.125</span>,
  <span class="st">&quot;Orange&quot;</span>, <span class="fl">0.205</span>,     <span class="fl">0.25</span>,
  <span class="st">&quot;Yellow&quot;</span>, <span class="fl">0.135</span>,     <span class="fl">0.125</span>,
  <span class="st">&quot;Green&quot;</span>,  <span class="fl">0.198</span>,     <span class="fl">0.125</span>,
  <span class="st">&quot;Blue&quot;</span>,   <span class="fl">0.207</span>,     <span class="fl">0.25</span>,
  <span class="st">&quot;Brown&quot;</span>,  <span class="fl">0.124</span>,     <span class="fl">0.125</span>
)

mms_population <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(Factory, value, <span class="op">-</span>color) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">percent</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(color, value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Factory =</span> <span class="kw">recode</span>(Factory,
                          <span class="dt">prop_clv =</span> <span class="st">&quot;Cleveland, OH (CLV)&quot;</span>,
                          <span class="dt">prop_hkp =</span> <span class="st">&quot;Hackettstown, NJ (HKP)&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pandoc.table</span>(<span class="dt">justify =</span> <span class="st">&quot;lcccccc&quot;</span>)</code></pre>
<table>
<colgroup>
<col width="33%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="12%" />
<col width="10%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Factory</th>
<th align="center">Blue</th>
<th align="center">Brown</th>
<th align="center">Green</th>
<th align="center">Orange</th>
<th align="center">Red</th>
<th align="center">Yellow</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Cleveland, OH (CLV)</td>
<td align="center">20.7%</td>
<td align="center">12.4%</td>
<td align="center">19.8%</td>
<td align="center">20.5%</td>
<td align="center">13.1%</td>
<td align="center">13.5%</td>
</tr>
<tr class="even">
<td align="left">Hackettstown, NJ (HKP)</td>
<td align="center">25.0%</td>
<td align="center">12.5%</td>
<td align="center">12.5%</td>
<td align="center">25.0%</td>
<td align="center">12.5%</td>
<td align="center">12.5%</td>
</tr>
</tbody>
</table>
<h3 id="mms-in-real-life">M&amp;Ms in real life</h3>
<p>Here are the results of the M&amp;M sampling that we did in class:</p>
<h4 id="individual-fun-packs">Individual fun-packs</h4>
<pre class="sourceCode r"><code class="sourceCode r">individual_data &lt;-<span class="st"> </span>class_results <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;Myself&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(color, count, <span class="kw">c</span>(Blue, Brown, Green, Orange, Red, Yellow)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> count <span class="op">/</span><span class="st"> </span>total) 

individual_data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(color) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_prop =</span> <span class="kw">mean</span>(prop),
            <span class="dt">sd_prop =</span> <span class="kw">sd</span>(prop))</code></pre>
<pre><code>## # A tibble: 6 x 3
##   color  avg_prop sd_prop
##   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 Blue      0.188  0.0880
## 2 Brown     0.128  0.0924
## 3 Green     0.221  0.113 
## 4 Orange    0.149  0.0784
## 5 Red       0.173  0.101 
## 6 Yellow    0.136  0.0781</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(individual_data, <span class="kw">aes</span>(<span class="dt">x =</span> prop, <span class="dt">fill =</span> color)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.05</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> mms_population, <span class="kw">aes</span>(<span class="dt">xintercept =</span> prop_clv),
             <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Proportion&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Actual colors in 31 fun-sized bags&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Orange dotted line shows the true population value&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> <span class="kw">percent_format</span>(<span class="dt">accuracy =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(mm_blue, mm_brown, mm_green, mm_orange, mm_red, mm_yellow)) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>color)</code></pre>
<p><img src="/class/09-class_files/figure-html/plot-real-individual-1.png" width="672" /></p>
<h4 id="team-checkout-line-sized-bags">Team checkout-line-sized bags</h4>
<pre class="sourceCode r"><code class="sourceCode r">team_data &lt;-<span class="st"> </span>class_results <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;My team&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(color, count, <span class="kw">c</span>(Blue, Brown, Green, Orange, Red, Yellow)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> count <span class="op">/</span><span class="st"> </span>total) 

team_data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(color) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_prop =</span> <span class="kw">mean</span>(prop),
            <span class="dt">sd_prop =</span> <span class="kw">sd</span>(prop))</code></pre>
<pre><code>## # A tibble: 6 x 3
##   color  avg_prop sd_prop
##   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 Blue      0.249  0.0672
## 2 Brown     0.107  0.0493
## 3 Green     0.253  0.0530
## 4 Orange    0.152  0.0967
## 5 Red       0.142  0.0430
## 6 Yellow    0.101  0.0285</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(team_data, <span class="kw">aes</span>(<span class="dt">x =</span> prop, <span class="dt">fill =</span> color)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.05</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> mms_population, <span class="kw">aes</span>(<span class="dt">xintercept =</span> prop_clv),
             <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Proportion&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Actual colors in 11 checkout-line-sized bags&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Orange dotted line shows the true population value&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> <span class="kw">percent_format</span>(<span class="dt">accuracy =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(mm_blue, mm_brown, mm_green, mm_orange, mm_red, mm_yellow)) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>color)</code></pre>
<p><img src="/class/09-class_files/figure-html/plot-real-team-1.png" width="672" /></p>
<h3 id="simulated-mms">Simulated M&amp;Ms</h3>
<p>We can use the <code>rep_sample_n()</code> function from the <code>moderndive</code> library to simulate taking a random sample from a giant vat of 100,000 Cleveland-produced M&amp;Ms.</p>
<p>Here’s what happens if we take one fun-sized sample of M&amp;Ms:</p>
<pre class="sourceCode r"><code class="sourceCode r">one_fun_sized_bag &lt;-<span class="st"> </span>tons_of_mms <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rep_sample_n</span>(<span class="dt">size =</span> <span class="dv">19</span>)

one_fun_sized_bag</code></pre>
<pre><code>## # A tibble: 19 x 3
## # Groups:   replicate [1]
##    replicate mm_id color 
##        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; 
##  1         1 41964 Yellow
##  2         1 15241 Red   
##  3         1 33702 Yellow
##  4         1 83023 Brown 
##  5         1 80756 Orange
##  6         1 85374 Blue  
##  7         1 68158 Brown 
##  8         1 59944 Brown 
##  9         1 68536 Red   
## 10         1 17380 Brown 
## 11         1 33247 Green 
## 12         1 49786 Yellow
## 13         1 16962 Brown 
## 14         1 98435 Red   
## 15         1 31785 Blue  
## 16         1 50166 Orange
## 17         1 85832 Yellow
## 18         1 98602 Green 
## 19         1 33026 Green</code></pre>
<p>We can calculate the proportion of colors in this one bag:</p>
<pre class="sourceCode r"><code class="sourceCode r">one_fun_sized_bag <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(color) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">prop =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">19</span>)</code></pre>
<pre><code>## # A tibble: 6 x 2
##   color   prop
##   &lt;chr&gt;  &lt;dbl&gt;
## 1 Blue   0.105
## 2 Brown  0.263
## 3 Green  0.158
## 4 Orange 0.105
## 5 Red    0.158
## 6 Yellow 0.211</code></pre>
<p>Just looking at one bag will result in a lot of variability. Some colors might not be in the bag; some colors might be overrepresented in the bag. We can improve our estimates of <span class="math inline">\(\widehat{p}\)</span> by increasing the number of samples we take. Here’s what happens if we look at 40 fun-sized bags, just like we did in-person in class:</p>
<pre class="sourceCode r"><code class="sourceCode r">forty_fun_sized_bags &lt;-<span class="st"> </span>tons_of_mms <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rep_sample_n</span>(<span class="dt">size =</span> <span class="dv">19</span>, <span class="dt">reps =</span> <span class="dv">40</span>)

forty_fun_sized_bags_color &lt;-<span class="st"> </span>forty_fun_sized_bags <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(color, replicate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">prop =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">19</span>) 

forty_fun_sized_bags_color <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_prop =</span> <span class="kw">mean</span>(prop),
            <span class="dt">sd_prop =</span> <span class="kw">sd</span>(prop))</code></pre>
<pre><code>## # A tibble: 6 x 3
##   color  avg_prop sd_prop
##   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 Blue      0.209  0.0832
## 2 Brown     0.144  0.0590
## 3 Green     0.225  0.110 
## 4 Orange    0.213  0.0829
## 5 Red       0.146  0.0850
## 6 Yellow    0.132  0.0660</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(forty_fun_sized_bags_color, <span class="kw">aes</span>(<span class="dt">x =</span> prop, <span class="dt">fill =</span> color)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.05</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> mms_population, <span class="kw">aes</span>(<span class="dt">xintercept =</span> prop_clv),
             <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Proportion&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Simulation of 40 party-sized bags&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Orange dotted line shows the true population value&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> <span class="kw">percent_format</span>(<span class="dt">accuracy =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(mm_blue, mm_brown, mm_green, mm_orange, mm_red, mm_yellow)) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>color)</code></pre>
<p><img src="/class/09-class_files/figure-html/plot-simulated-forty-bags-1.png" width="672" /></p>
<p>There’s still some variability, but the standard deviation is smaller than it was with just one fun-sized bag.</p>
<p>Next let’s simulate 10 checkout-line-sized bags (what we did as teams in class). These have roughly 55 M&amp;Ms per bag:</p>
<pre class="sourceCode r"><code class="sourceCode r">ten_checkout_sized_bags &lt;-<span class="st"> </span>tons_of_mms <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rep_sample_n</span>(<span class="dt">size =</span> <span class="dv">55</span>, <span class="dt">reps =</span> <span class="dv">10</span>)

ten_checkout_sized_bags_color &lt;-<span class="st"> </span>ten_checkout_sized_bags <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(color, replicate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">prop =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">55</span>) 

ten_checkout_sized_bags_color <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_prop =</span> <span class="kw">mean</span>(prop),
            <span class="dt">sd_prop =</span> <span class="kw">sd</span>(prop))</code></pre>
<pre><code>## # A tibble: 6 x 3
##   color  avg_prop sd_prop
##   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 Blue      0.198  0.0510
## 2 Brown     0.138  0.0385
## 3 Green     0.202  0.0525
## 4 Orange    0.205  0.0790
## 5 Red       0.138  0.0323
## 6 Yellow    0.118  0.0570</code></pre>
<p>Our errors are shrinking and the means are starting to converge on the true population <span class="math inline">\(p\)</span>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ten_checkout_sized_bags_color, <span class="kw">aes</span>(<span class="dt">x =</span> prop, <span class="dt">fill =</span> color)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.025</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> mms_population, <span class="kw">aes</span>(<span class="dt">xintercept =</span> prop_clv),
             <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Proportion&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Simulation of 10 checkout-line-sized bags&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Orange dotted line shows the true population value&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> <span class="kw">percent_format</span>(<span class="dt">accuracy =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(mm_blue, mm_brown, mm_green, mm_orange, mm_red, mm_yellow)) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>color)</code></pre>
<p><img src="/class/09-class_files/figure-html/plot-ten-checkout-1.png" width="672" /></p>
<p>Now let’s move beyond what we did in class. Let’s simulate 10 party-sized bags (42 ounces; each contains roughly 1,000 M&amp;Ms):</p>
<pre class="sourceCode r"><code class="sourceCode r">ten_party_sized_bags &lt;-<span class="st"> </span>tons_of_mms <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rep_sample_n</span>(<span class="dt">size =</span> <span class="dv">1000</span>, <span class="dt">reps =</span> <span class="dv">10</span>)

ten_party_sized_bags_color &lt;-<span class="st"> </span>ten_party_sized_bags <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(color, replicate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">prop =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>) 

ten_party_sized_bags_color <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_prop =</span> <span class="kw">mean</span>(prop),
            <span class="dt">sd_prop =</span> <span class="kw">sd</span>(prop))</code></pre>
<pre><code>## # A tibble: 6 x 3
##   color  avg_prop sd_prop
##   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 Blue      0.206 0.0115 
## 2 Brown     0.123 0.0123 
## 3 Green     0.198 0.0137 
## 4 Orange    0.206 0.00950
## 5 Red       0.129 0.0130 
## 6 Yellow    0.138 0.00959</code></pre>
<p>The errors are now substantially smaller. Check out how little variation there is!</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ten_party_sized_bags_color, <span class="kw">aes</span>(<span class="dt">x =</span> prop, <span class="dt">fill =</span> color)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.025</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> mms_population, <span class="kw">aes</span>(<span class="dt">xintercept =</span> prop_clv),
             <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Proportion&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Simulation of 10 party-sized bags&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Orange dotted line shows the true population value&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> <span class="kw">percent_format</span>(<span class="dt">accuracy =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(mm_blue, mm_brown, mm_green, mm_orange, mm_red, mm_yellow)) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>color)</code></pre>
<p><img src="/class/09-class_files/figure-html/plot-ten-party-1.png" width="672" /></p>
<p>With only 10 large-ish bags of M&amp;Ms (420 ounces, or 26.25 pounds), we can guess the proportion of colors for <em>the entire population of M&amp;Ms created in Cleveland</em> with fairly high confidence. That’s amazing.</p>
<h3 id="the-importance-of-sample-size">The importance of sample size</h3>
<p>As a final demonstration of this, here’s a simulation of what happens to our <span class="math inline">\(\widehat{p}\)</span> estimates and margins of error as we increase the sample size from 5 to 1,000. The x-axis here show the sample size; the y-axis shows the <span class="math inline">\(\widehat{p}\)</span> for each color at that sample size; the orange ribbon shows the 95% confidence interval, or margin of error; the black horizontal line shows the true population average.</p>
<pre class="sourceCode r"><code class="sourceCode r">different_ns &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">n =</span> <span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">1000</span>, <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">draw =</span> n <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">rep_sample_n</span>(tons_of_mms, <span class="dt">size =</span> .x, <span class="dt">reps =</span> <span class="dv">1</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(draw) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(n, color) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">prop =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="kw">max</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># This is the real way of calculating the margin of error; we&#39;ll talk about this next week</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">se =</span> <span class="kw">sqrt</span>(prop <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>prop) <span class="op">/</span><span class="st"> </span>n),
         <span class="dt">moe =</span> <span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se,
         <span class="dt">lower_ci =</span> prop <span class="op">-</span><span class="st"> </span>moe,
         <span class="dt">upper_ci =</span> prop <span class="op">+</span><span class="st"> </span>moe)

<span class="kw">ggplot</span>(different_ns, <span class="kw">aes</span>(<span class="dt">x =</span> n, <span class="dt">y =</span> prop)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower_ci, <span class="dt">ymax =</span> upper_ci), <span class="dt">fill =</span> <span class="st">&quot;orange&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">0.25</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">data =</span> mms_population, <span class="kw">aes</span>(<span class="dt">yintercept =</span> prop_clv), <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">data =</span> mms_population, <span class="kw">aes</span>(<span class="dt">yintercept =</span> prop_clv), <span class="dt">size =</span> <span class="fl">0.75</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Sample size (n)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Proportion&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Accuracy of p-hat as sample size increases&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Black horizontal line shows the true population value &quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="kw">percent_format</span>(<span class="dt">accuracy =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> comma) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>color) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())</code></pre>
<p><img src="/class/09-class_files/figure-html/different-ns-1.png" width="672" /></p>
<p>Notice how the estimates and errors converge on the true <span class="math inline">\(p\)</span> fairly quickly. When <span class="math inline">\(n\)</span> is small, there’s a lot of variation, but once it’s 250+, there’s not a huge improvement as you increase the sample size.</p>
<p>This is even more apparent if we plot just the changes in the margin of error as we increase <span class="math inline">\(n\)</span>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(different_ns, <span class="kw">aes</span>(<span class="dt">x =</span> n, <span class="dt">y =</span> moe)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.25</span>, <span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Sample size (n)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Margin of error (± this percent)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="kw">percent_format</span>(<span class="dt">accuracy =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> comma) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())</code></pre>
<p><img src="/class/09-class_files/figure-html/plot-moe-different-ns-1.png" width="672" /></p>
<p>Notice how low the margin of error is at 1,000. Given that there are roughly 1,000 M&amp;Ms in a 42 ounce party bag, we can make a pretty good guess (with a margin of error of 2ish%) of the actual population-level distribution of colors with <em>just one big bag of M&amp;Ms</em>. That’s mindblowing.</p>
<p>This is why presidential approval polls tend to have <span class="math inline">\(n\)</span>s that seem really low (1,300; 1,500; 800, etc.). Polls with these sample sizes all have margins of error of 2–3%. Bumping up the sample size to 10,000 or something huge would shrink the margins of error, but not by a huge amount. If we took a sample of 10,000 M&amp;Ms, here’s what our margin of error would be:</p>
<pre class="sourceCode r"><code class="sourceCode r">tons_of_mms <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rep_sample_n</span>(<span class="dv">10000</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(color) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">prop =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">10000</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">se =</span> <span class="kw">sqrt</span>(prop <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>prop) <span class="op">/</span><span class="st"> </span><span class="dv">10000</span>),
         <span class="dt">moe =</span> <span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se,
         <span class="dt">lower_ci =</span> prop <span class="op">-</span><span class="st"> </span>moe,
         <span class="dt">upper_ci =</span> prop <span class="op">+</span><span class="st"> </span>moe)</code></pre>
<pre><code>## # A tibble: 6 x 6
##   color   prop      se     moe lower_ci upper_ci
##   &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 Blue   0.205 0.00404 0.00791    0.197    0.213
## 2 Brown  0.124 0.00330 0.00647    0.118    0.131
## 3 Green  0.201 0.00401 0.00785    0.193    0.209
## 4 Orange 0.205 0.00404 0.00791    0.197    0.213
## 5 Red    0.131 0.00337 0.00661    0.124    0.137
## 6 Yellow 0.134 0.00341 0.00668    0.127    0.141</code></pre>
<p>Between 0.65% and 0.8%, depending on the color. That’s definitely an improvement over 2%, but it’s not huge. Consider, for instance, moving from a sample size of 20, where the margin of error is 20ish%, to a sample size of 500, where it’s around 4%. Increasing sample sizes at the low end of the spectrum results in huge gains to <span class="math inline">\(\widehat{p}\)</span> accuracy. Increasing sample sizes from high to even higher doesn’t end up helping all that much with accuracy.</p>
<p>Pew, CNN, Quinnipiac, and others face a tradeoff: take huge (expensive) samples to get the most accurate estimate of <span class="math inline">\(\widehat{p}\)</span>, or take smaller (cheaper) samples to get <span class="math inline">\(\widehat{p}\)</span> estimates that are less accurate, but still pretty darn accurate in the end. They lean towards the cheaper option.</p>
<h2 id="clearest-and-muddiest-things">Clearest and muddiest things</h2>
<p>Go to <a href="https://goo.gl/forms/PlPwZGhMOdU9mKfC3">this form</a> and answer these three questions:</p>
<ol style="list-style-type: decimal">
<li>What was the muddiest thing from class today? What are you still wondering about?</li>
<li>What was the clearest thing from class today?</li>
<li>What was the most exciting thing you learned?</li>
</ol>
<p>I’ll compile the questions and send out answers after class.</p>
